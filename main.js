(()=>{"use strict";var t="1a10498b-0e1a-4d80-82be-5e39821adf2c",e=function(){return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-1/users/me",{method:"GET",headers:{authorization:t}}).then(o)},n=function(){return fetch("https://nomoreparties.co/v1/wff-cohort-1/cards",{method:"GET",headers:{authorization:t}}).then(o)},o=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(res.status))},r=document.querySelector("#card-template").content;function c(t,e,n,o){var c=r.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__image"),i=c.querySelector(".card__title"),u=c.querySelector(".card__delete-button"),s=c.querySelector(".card__like-button"),l=c.querySelector(".card__like-counter"),d=c.id=t._id;return a.src=t.link,i.textContent=a.alt=t.name,l.textContent=t.likes.length,"cabca2f13d88c94083c8814a"!==t.owner._id?u.style.display="none":u.addEventListener("click",(function(){o(d)})),s.addEventListener("click",(function(t){return e(t,d,l)})),a.addEventListener("click",n),c}function a(e,n,r){e.target.classList.contains("card__like-button_is-active")?function(e){return fetch("https://nomoreparties.co/v1/wff-cohort-1/cards/likes/".concat(e),{method:"DELETE",headers:{authorization:t,"Content-Type":"application/json"}}).then(o)}(n).then((function(t){e.target.classList.remove("card__like-button_is-active"),r.textContent=t.likes.length})).catch((function(t){return console.log(t)})):function(e){return fetch("https://nomoreparties.co/v1/wff-cohort-1/cards/likes/".concat(e),{method:"PUT",headers:{authorization:t,"Content-Type":"application/json"}}).then(o)}(n).then((function(t){e.target.classList.add("card__like-button_is-active"),r.textContent=t.likes.length})).catch((function(t){return console.log(t)}))}function i(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",s),document.addEventListener("click",l)}function u(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",s),document.removeEventListener("click",l)}function s(t){"Escape"===t.key&&u(document.querySelector(".popup_is-opened"))}function l(t){t.target.classList.contains("popup_is-opened")&&u(t.target)}var d=function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.remove("".concat(n)),r.classList.remove("".concat(o)),r.textContent=""};function p(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.removeAttribute("disabled",""),e.classList.remove("".concat(n))):(e.classList.add("".concat(n)),e.setAttribute("disabled",""))}function f(t,e){var n=Array.from(t.querySelectorAll("".concat(e.inputSelector))),o=t.querySelector("".concat(e.submitButtonSelector));n.forEach((function(n){d(t,n,e.inputErrorClass,e.errorClass)})),o.classList.add(e.inactiveButtonClass)}var m,h=document.querySelector(".places__list"),v=document.querySelector(".profile__image"),_=document.querySelector(".popup_avatar"),y=document.forms["avatar-profile"],S=y.elements.link,C=y.querySelector(".popup__button"),b=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),g=document.querySelector(".profile__image"),q=document.querySelector(".popup_type_edit"),L=document.querySelector(".profile__edit-button"),k=document.forms["edit-profile"],x=k.elements.name,T=k.elements.description,w=document.querySelector(".popup_type_new-card"),A=document.querySelector(".profile__add-button"),j=document.forms["new-place"],z=j.elements["place-name"],D=j.elements.link,B=j.querySelector(".popup__button"),P=document.querySelector(".popup_type_image"),N=P.querySelector(".popup__image"),O=P.querySelector(".popup__caption"),J=document.querySelector(".popup_confirm-delete-card"),M=document.forms["delete-card"],G=document.querySelectorAll(".popup__close"),H={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function I(t){N.src=t.target.src,N.alt=O.textContent=t.target.alt,i(P)}function V(t){M.dataset.id=t,i(J)}Promise.all([n,e]).then((function(){n().then((function(t){t.forEach((function(t){h.append(c(t,a,I,V))}))})),e().then((function(t){b.textContent=t.name,E.textContent=t.about,g.style.backgroundImage="url('".concat(t.avatar,"')")}))})).catch((function(t){console.log(t)})),j.addEventListener("submit",(function(e){e.preventDefault(),B.textContent="Сохранение...",function(e,n){return fetch("https://nomoreparties.co/v1/wff-cohort-1/cards",{method:"POST",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:e.value,link:n.value})}).then(o)}(z,D).then((function(t){h.prepend(c(t,a,I,V))})).catch((function(t){console.log(t)})).finally((function(){B.textContent="Сохранить"})),e.target.reset(),u(w)})),v.addEventListener("click",(function(){i(_)})),L.addEventListener("click",(function(){x.value=b.textContent,T.value=E.textContent,f(k,H),i(q)})),A.addEventListener("click",(function(){f(j,H),i(w)})),G.forEach((function(t){t.addEventListener("click",(function(t){u(t.target.closest(".popup"))}))})),y.addEventListener("submit",(function(e){var n;e.preventDefault(),C.textContent="Сохранение...",(n=S.value,fetch("https://nomoreparties.co/v1/wff-cohort-1/users/me/avatar",{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({avatar:n})}).then(o).catch((function(t){console.log(t)}))).then((function(t){v.style.backgroundImage="url('".concat(t.avatar,"')"),console.log(t),u(_)})).finally((function(){B.textContent="Сохранить"}))})),k.addEventListener("submit",(function(e){e.preventDefault(),b.textContent=x.value,E.textContent=T.value,function(e,n){fetch("https://nomoreparties.co/v1/wff-cohort-1/users/me",{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:n})}).catch((function(t){console.log(t)}))}(b.textContent,E.textContent),u(q)})),M.addEventListener("click",(function(e){e.preventDefault();var n=M.dataset.id;(function(e){return fetch("https://nomoreparties.co/v1/wff-cohort-1/cards/".concat(e),{method:"DELETE",headers:{authorization:t,"Content-Type":"application/json"}}).then(o)})(n).then((function(){document.querySelector("[id='".concat(n,"']")).remove(),u(J)}))})),m=H,Array.from(document.querySelectorAll("".concat(m.formSelector))).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e,n,o,r,c){var a=Array.from(t.querySelectorAll("".concat(e))),i=t.querySelector("".concat(n));p(a,i,o),a.forEach((function(e){e.addEventListener("input",(function(){!function(t,e,n,o){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?d(t,e,n,o):function(t,e,n,o,r){var c=t.querySelector(".".concat(e.id,"-error"));e.classList.add("".concat(o)),c.textContent=n,c.classList.add("".concat(r))}(t,e,e.validationMessage,n,o)}(t,e,r,c),p(a,i,o)}))}))}(t,m.inputSelector,m.submitButtonSelector,m.inactiveButtonClass,m.inputErrorClass,m.errorClass)}))})();